<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Giornaliero</title>
    <!-- Inserisci qui la tua favicon.ico nella stessa cartella del file html -->
    <link rel="icon" href="favicon.ico">
    
    <!-- Libreria per la lettura di file Excel (SheetJS) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        /* --- FONT E STILI GLOBALI --- */
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap');

        :root {
            --brand-blue: #003366;
            --brand-yellow: #f4e600;
            --light-gray: #f5f7fa;
            --medium-gray: #e1e4e8;
            --dark-gray: #24292e;
            --white: #ffffff;
            --success-green: #28a745;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--light-gray);
            color: var(--dark-gray);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- LAYOUT PRINCIPALE --- */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--brand-blue);
            color: var(--white);
            padding: 25px 30px;
            text-align: center;
            border-bottom: 5px solid var(--brand-yellow);
        }

        header h1 {
            font-size: 2rem;
            margin-bottom: 0.25rem;
            font-weight: 700;
        }

        header p {
            font-size: 1.1rem;
            color: var(--brand-yellow);
            font-weight: 600;
        }

        main {
            padding: 30px 0;
        }
        
        /* --- SEZIONE UPLOAD --- */
        .upload-section {
            background-color: var(--white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .upload-section h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--brand-blue);
        }

        input[type="file"] {
            display: none;
        }

        .upload-button {
            display: inline-block;
            background-color: var(--brand-yellow);
            color: var(--brand-blue);
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            border: 2px solid var(--brand-yellow);
        }

        .upload-button:hover {
            background-color: #e0d300;
            transform: translateY(-2px);
        }
        
        .file-info {
            margin-top: 15px;
            color: #666;
            font-style: italic;
        }

        /* --- SEZIONE RISULTATI --- */
        #results-container {
            margin-top: 30px;
            display: none;
        }

        .result-card {
            background-color: var(--white);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--medium-gray);
            padding-bottom: 15px;
            margin-bottom: 15px;
        }

        .result-card h3 {
            color: var(--brand-blue);
            font-size: 1.25rem;
            border-left: 4px solid var(--brand-yellow);
            padding-left: 15px;
        }
        
        .copy-button {
            background-color: transparent;
            border: 1px solid var(--medium-gray);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .copy-button:hover {
            background-color: #f0f0f0;
            border-color: var(--brand-blue);
        }
        
        .copy-button svg {
            width: 16px;
            height: 16px;
            fill: #555;
            transition: fill 0.2s ease;
        }

        .copy-button:hover svg {
            fill: var(--brand-blue);
        }

        .card-content {
            font-size: 1rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--dark-gray);
        }
        
        #total-posts {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--brand-blue);
        }
        
        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 20px;
            }

            header h1 {
                font-size: 1.8rem;
            }

            header p {
                font-size: 1rem;
            }
            
            .upload-section, .result-card {
                padding: 20px;
            }
            .result-card h3 {
                font-size: 1.15rem;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>Report Giornaliero</h1>
        <p>Argomenti tratti e numero post</p>
    </header>

    <div class="container">
        <main>
            <section class="upload-section">
                <h2>Carica il tuo file</h2>
                <label for="file-input" class="upload-button" id="upload-button-label">Seleziona file Excel</label>
                <input type="file" id="file-input" accept=".xlsx, .xls">
                <p class="file-info" id="file-info-text">Nessun file selezionato.</p>
            </section>

            <section id="results-container">
                <!-- Blocco 1: Totale Post -->
                <div class="result-card">
                    <div class="card-header">
                        <h3>Totale Post e Condivisioni</h3>
                        <button class="copy-button" data-target="#total-posts" title="Copia totale post">
                            <span class="icon-copy">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                            </span>
                        </button>
                    </div>
                    <div class="card-content" id="total-posts"></div>
                </div>

                <!-- Blocco 2: Conteggio per Canale -->
                <div class="result-card">
                    <div class="card-header">
                        <h3>Post per Canale Social</h3>
                        <button class="copy-button" data-target="#platform-count" title="Copia conteggio canali">
                            <span class="icon-copy">
                               <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                            </span>
                        </button>
                    </div>
                    <div class="card-content" id="platform-count"></div>
                </div>

                <!-- Blocco 3: Elenco Temi -->
                <div class="result-card">
                    <div class="card-header">
                        <h3>Temi Trattati</h3>
                         <button class="copy-button" data-target="#topic-list" title="Copia elenco temi">
                            <span class="icon-copy">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                            </span>
                        </button>
                    </div>
                    <pre class="card-content" id="topic-list"></pre>
                </div>
            </section>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const fileInput = document.getElementById('file-input');
    const uploadButtonLabel = document.getElementById('upload-button-label');
    const fileInfoText = document.getElementById('file-info-text');
    const resultsContainer = document.getElementById('results-container');
    
    const totalPostsEl = document.getElementById('total-posts');
    const platformCountEl = document.getElementById('platform-count');
    const topicListEl = document.getElementById('topic-list');

    const originalButtonText = uploadButtonLabel.textContent;

    fileInput.addEventListener('change', handleFile);

    function handleFile(event) {
        const file = event.target.files[0];
        if (!file) return;

        fileInfoText.textContent = `File selezionato: ${file.name}`;
        uploadButtonLabel.textContent = 'Elaborazione...';
        uploadButtonLabel.style.cursor = 'not-allowed';
        resultsContainer.style.display = 'none';

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: "" });

                processData(jsonData);

                uploadButtonLabel.textContent = 'File Elaborato!';
                setTimeout(() => {
                    uploadButtonLabel.textContent = originalButtonText;
                    uploadButtonLabel.style.cursor = 'pointer';
                }, 3000);

            } catch (error) {
                console.error("Errore durante l'elaborazione del file:", error);
                fileInfoText.textContent = 'Errore: il file non è valido o è corrotto.';
                uploadButtonLabel.textContent = 'Riprova';
                uploadButtonLabel.style.cursor = 'pointer';
            }
        };
        reader.readAsArrayBuffer(file);
    }

    function processData(data) {
        // 1) Totale post e condivisioni
        const totalPosts = data.length;
        totalPostsEl.textContent = totalPosts;

        // 2) Conteggio per canale social
        const platformCounts = data.reduce((acc, row) => {
            const platform = row['Platform'];
            if (platform) {
                const cleanedPlatform = String(platform).trim();
                acc[cleanedPlatform] = (acc[cleanedPlatform] || 0) + 1;
            }
            return acc;
        }, {});
        
        // MODIFICA: Aggiunto .sort() per ordinare alfabeticamente per nome canale
        const platformOutput = Object.entries(platformCounts)
            .sort((a, b) => a[0].localeCompare(b[0])) // Ordina l'array per il primo elemento (il nome)
            .map(([platform, count]) => {
                let capitalizedPlatform = platform.charAt(0).toUpperCase() + platform.slice(1).toLowerCase();
                
                if (capitalizedPlatform === 'Twitter') {
                    capitalizedPlatform = 'X';
                }
                
                return `${capitalizedPlatform} ${count}`;
            })
            .join(', ');
        platformCountEl.textContent = platformOutput;

        // 3) Elenco dei temi
        const topics = new Set();
        data.forEach(row => {
            const labels = row['Labels'];
            if (labels && typeof labels === 'string') {
                const labelParts = labels.split(';');
                labelParts.forEach(part => {
                    const cleanedPart = part.trim();
                    if (cleanedPart && !cleanedPart.startsWith('#')) {
                        const formattedTopic = cleanedPart.charAt(0).toUpperCase() + cleanedPart.slice(1).toLowerCase();
                        topics.add(formattedTopic);
                    }
                });
            }
        });

        const topicOutput = [...topics].sort().join('\n');
        topicListEl.textContent = topicOutput;
        
        resultsContainer.style.display = 'block';
    }

    // Gestione dei pulsanti "copia"
    document.querySelectorAll('.copy-button').forEach(button => {
        button.addEventListener('click', () => {
            const targetId = button.getAttribute('data-target');
            const contentElement = document.querySelector(targetId);
            const textToCopy = contentElement.textContent;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                const icon = button.querySelector('.icon-copy');
                const originalContent = icon.innerHTML;
                icon.innerHTML = '✓';
                icon.style.color = 'var(--success-green)';
                button.style.borderColor = 'var(--success-green)';
                
                setTimeout(() => {
                    icon.innerHTML = originalContent;
                    icon.style.color = ''; 
                    button.style.borderColor = '';
                }, 2000);
            }).catch(err => {
                console.error('Errore durante la copia:', err);
                alert("Impossibile copiare il testo.");
            });
        });
    });
});
</script>

</body>
</html>
